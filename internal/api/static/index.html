<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClaudeGate — API Playground</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root {
  --bg-deep: #121417;
  --bg-base: #1a1d23;
  --bg-raised: #22262e;
  --bg-elevated: #2a2f38;
  --bg-hover: #323842;

  --border-subtle: rgba(255,255,255,0.06);
  --border-default: rgba(255,255,255,0.1);
  --border-strong: rgba(255,255,255,0.16);

  --text-primary: #e8e6e3;
  --text-secondary: #9b9a97;
  --text-tertiary: #6b6a68;
  --text-inverse: #121417;

  --accent: #d4a574;
  --accent-dim: rgba(212,165,116,0.12);
  --accent-glow: rgba(212,165,116,0.25);
  --accent-bright: #e8be91;

  --green: #7ec699;
  --green-dim: rgba(126,198,153,0.12);
  --red: #e06c75;
  --red-dim: rgba(224,108,117,0.12);
  --blue: #82aaff;
  --blue-dim: rgba(130,170,255,0.12);
  --yellow: #e5c07b;
  --yellow-dim: rgba(229,192,123,0.12);
  --purple: #c792ea;
  --purple-dim: rgba(199,146,234,0.12);

  --font-body: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-mono: 'JetBrains Mono', 'SF Mono', Consolas, monospace;

  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 14px;

  --shadow-sm: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.35), 0 2px 4px rgba(0,0,0,0.25);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.4), 0 4px 8px rgba(0,0,0,0.3);

  --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-med: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

html, body {
  height: 100%;
  background: var(--bg-deep);
  color: var(--text-primary);
  font-family: var(--font-body);
  font-size: 14px;
  line-height: 1.55;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a { color: var(--accent); text-decoration: none; }
a:hover { color: var(--accent-bright); }

/* Scrollbar */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-tertiary); }

/* ── Buttons ── */
button {
  cursor: pointer;
  border: none;
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: 13px;
  transition: all var(--transition-fast);
  outline: none;
}
button:focus-visible {
  box-shadow: 0 0 0 2px var(--bg-deep), 0 0 0 4px var(--accent);
}

/* ── Inputs ── */
input, select, textarea {
  background: var(--bg-deep);
  color: var(--text-primary);
  border: 1px solid var(--border-default);
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: 13px;
  padding: 8px 12px;
  width: 100%;
  outline: none;
  transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
}
input:focus, select:focus, textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-dim);
}
textarea { resize: vertical; line-height: 1.55; }
select { cursor: pointer; }
select option { background: var(--bg-raised); }

/* ── Layout ── */
.app {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  position: relative;
}

/* Animated mesh background */
.app::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse 60% 50% at 10% 20%, rgba(212,165,116,0.04), transparent),
    radial-gradient(ellipse 50% 60% at 90% 80%, rgba(130,170,255,0.03), transparent),
    radial-gradient(ellipse 70% 40% at 50% 50%, rgba(199,146,234,0.02), transparent);
  pointer-events: none;
  z-index: 0;
  animation: meshShift 30s ease-in-out infinite alternate;
}
@keyframes meshShift {
  0% { opacity: 1; }
  50% { opacity: 0.6; }
  100% { opacity: 1; }
}

/* Noise overlay */
.app::after {
  content: '';
  position: fixed;
  inset: 0;
  opacity: 0.015;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
}

/* ── Header ── */
.header {
  position: relative;
  z-index: 10;
  background: var(--bg-base);
  border-bottom: 1px solid var(--border-subtle);
  padding: 0 24px;
  height: 56px;
  display: flex;
  align-items: center;
  gap: 20px;
  flex-shrink: 0;
  box-shadow: 0 1px 8px rgba(0,0,0,0.2);
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}
.logo-icon {
  width: 28px;
  height: 28px;
  border-radius: var(--radius-sm);
  background: linear-gradient(135deg, var(--accent) 0%, #c08850 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
  color: var(--text-inverse);
  box-shadow: 0 2px 8px rgba(212,165,116,0.3);
}
.logo-text {
  font-size: 15px;
  font-weight: 600;
  letter-spacing: -0.3px;
  white-space: nowrap;
}
.logo-sub {
  color: var(--text-tertiary);
  font-weight: 400;
  font-size: 13px;
  margin-left: 2px;
}

.apikey-bar {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  max-width: 460px;
  min-width: 200px;
}
.apikey-bar label {
  font-size: 12px;
  color: var(--text-tertiary);
  font-weight: 500;
  white-space: nowrap;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.apikey-wrap {
  position: relative;
  flex: 1;
}
.apikey-wrap input {
  padding-right: 36px;
  font-family: var(--font-mono);
  font-size: 12px;
  height: 34px;
}
.apikey-toggle {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--text-tertiary);
  padding: 2px;
  font-size: 14px;
  line-height: 1;
  border-radius: 3px;
}
.apikey-toggle:hover { color: var(--text-secondary); }

.key-status {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text-tertiary);
  flex-shrink: 0;
  transition: all var(--transition-med);
}
.key-status.valid { background: var(--green); box-shadow: 0 0 8px rgba(126,198,153,0.4); }
.key-status.invalid { background: var(--red); box-shadow: 0 0 8px rgba(224,108,117,0.4); }

.btn-save {
  background: var(--accent);
  color: var(--text-inverse);
  padding: 6px 16px;
  font-weight: 600;
  font-size: 12px;
  white-space: nowrap;
  letter-spacing: 0.3px;
  height: 34px;
}
.btn-save:hover { background: var(--accent-bright); }

/* ── Main Area ── */
.main {
  position: relative;
  z-index: 1;
  display: flex;
  flex: 1;
  overflow: hidden;
}

.panel-left {
  width: 48%;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  flex-shrink: 0;
}

.panel-right {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  min-width: 0;
}

.splitter {
  width: 1px;
  background: var(--border-subtle);
  cursor: col-resize;
  flex-shrink: 0;
  position: relative;
  user-select: none;
  z-index: 5;
}
.splitter::before {
  content: '';
  position: absolute;
  inset: 0 -6px;
  z-index: 1;
}
.splitter::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 3px;
  height: 40px;
  border-radius: 3px;
  background: var(--border-default);
  transition: all var(--transition-fast);
}
.splitter:hover::after, .splitter.active::after {
  background: var(--accent);
  height: 60px;
  box-shadow: 0 0 10px var(--accent-dim);
}

/* ── Cards ── */
.card {
  background: var(--bg-base);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  transition: border-color var(--transition-fast);
}
.card:hover { border-color: var(--border-default); }

.card-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.card-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border-subtle);
}

/* ── Playground ── */
.field { display: flex; flex-direction: column; gap: 5px; }
.field-label {
  font-size: 12px;
  font-weight: 500;
  color: var(--text-secondary);
}
.field-required { color: var(--red); }

.row { display: flex; gap: 10px; align-items: flex-end; }
.row .field { flex: 1; }

.system-toggle {
  background: none;
  color: var(--accent);
  font-size: 12px;
  font-weight: 500;
  padding: 0;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 6px;
}
.system-toggle:hover { color: var(--accent-bright); }
.system-toggle .chevron-sm {
  transition: transform var(--transition-fast);
  font-size: 9px;
}
.system-toggle.open .chevron-sm { transform: rotate(90deg); }
.collapsed { display: none; }

.checkbox-wrap {
  display: flex;
  align-items: center;
  gap: 7px;
  font-size: 12px;
  color: var(--text-secondary);
  cursor: pointer;
  white-space: nowrap;
  user-select: none;
  padding-bottom: 9px;
}
.checkbox-wrap input[type="checkbox"] {
  width: 15px;
  height: 15px;
  accent-color: var(--accent);
  cursor: pointer;
}

.btn-send {
  background: linear-gradient(135deg, var(--accent) 0%, #c08850 100%);
  color: var(--text-inverse);
  padding: 10px 24px;
  font-size: 13px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
  border-radius: var(--radius-md);
  box-shadow: 0 2px 10px rgba(212,165,116,0.25);
  letter-spacing: 0.2px;
}
.btn-send:hover { box-shadow: 0 4px 16px rgba(212,165,116,0.35); transform: translateY(-1px); }
.btn-send:active { transform: translateY(0); }
.btn-send:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
.btn-send svg { width: 14px; height: 14px; }

/* Status badges */
.badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.3px;
  text-transform: uppercase;
}
.badge::before {
  content: '';
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}
.badge-queued { background: var(--yellow-dim); color: var(--yellow); }
.badge-queued::before { background: var(--yellow); }
.badge-processing { background: var(--blue-dim); color: var(--blue); }
.badge-processing::before { background: var(--blue); animation: blink 1.2s ease-in-out infinite; }
.badge-completed { background: var(--green-dim); color: var(--green); }
.badge-completed::before { background: var(--green); }
.badge-failed { background: var(--red-dim); color: var(--red); }
.badge-failed::before { background: var(--red); }
.badge-cancelled { background: rgba(155,154,151,0.1); color: var(--text-secondary); }
.badge-cancelled::before { background: var(--text-secondary); }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

/* Response area */
.response-area { margin-top: 4px; }
.response-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
  flex-wrap: wrap;
}
.response-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.8px;
}
.response-jobid {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-tertiary);
}
.response-box {
  background: var(--bg-deep);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  padding: 14px 16px;
  font-family: var(--font-mono);
  font-size: 13px;
  min-height: 120px;
  max-height: 340px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.65;
  transition: border-color var(--transition-fast);
}
.response-box:hover { border-color: var(--border-default); }
.response-empty {
  color: var(--text-tertiary);
  font-style: italic;
  font-family: var(--font-body);
  font-size: 13px;
}

/* ── Job History ── */
.history-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}
.btn-refresh {
  background: none;
  border: 1px solid var(--border-default);
  color: var(--text-secondary);
  padding: 5px 12px;
  font-size: 12px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  gap: 5px;
}
.btn-refresh:hover {
  border-color: var(--accent);
  color: var(--accent);
}

.job-list { display: flex; flex-direction: column; gap: 4px; }

.job-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: var(--bg-deep);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--transition-fast);
}
.job-item:hover {
  border-color: var(--accent);
  background: var(--bg-raised);
  box-shadow: 0 0 0 1px var(--accent-dim);
}
.job-id-short {
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--accent);
  flex-shrink: 0;
}
.job-model {
  font-size: 11px;
  color: var(--text-tertiary);
  flex-shrink: 0;
  font-weight: 500;
  background: var(--bg-elevated);
  padding: 1px 6px;
  border-radius: 4px;
}
.job-time {
  font-size: 11px;
  color: var(--text-tertiary);
  margin-left: auto;
  flex-shrink: 0;
}

.btn-action-sm {
  background: none;
  color: var(--text-tertiary);
  padding: 3px 6px;
  font-size: 13px;
  flex-shrink: 0;
  border-radius: 4px;
  line-height: 1;
}
.btn-action-sm:hover {
  background: var(--bg-hover);
  color: var(--text-secondary);
}
.btn-action-sm.danger:hover {
  color: var(--red);
  background: var(--red-dim);
}

.job-list-empty {
  color: var(--text-tertiary);
  font-size: 12px;
  font-style: italic;
  padding: 8px 0;
}

/* ── Right Panel Sections ── */
.section-title {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.section-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border-subtle);
}
.section-desc {
  font-size: 13px;
  color: var(--text-tertiary);
  margin-bottom: 12px;
  line-height: 1.5;
}
.section-gap { margin-top: 28px; }

/* ── Collapsible Endpoints / Steps ── */
.collapse-item {
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  margin-bottom: 6px;
  overflow: hidden;
  transition: border-color var(--transition-fast);
  background: var(--bg-base);
}
.collapse-item:hover { border-color: var(--border-default); }

.collapse-head {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  cursor: pointer;
  user-select: none;
  transition: background var(--transition-fast);
}
.collapse-head:hover { background: var(--bg-raised); }

.method-badge {
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  padding: 3px 8px;
  border-radius: 4px;
  flex-shrink: 0;
  letter-spacing: 0.5px;
}
.method-get { background: var(--green-dim); color: var(--green); }
.method-post { background: var(--blue-dim); color: var(--blue); }
.method-delete { background: var(--red-dim); color: var(--red); }
.method-step { background: var(--purple-dim); color: var(--purple); }
.method-lang { background: var(--accent-dim); color: var(--accent); }

.collapse-path {
  font-family: var(--font-mono);
  font-size: 13px;
  flex: 1;
  color: var(--text-primary);
}
.collapse-path.non-mono {
  font-family: var(--font-body);
  font-weight: 500;
}

.collapse-chevron {
  color: var(--text-tertiary);
  font-size: 10px;
  transition: transform var(--transition-fast);
  flex-shrink: 0;
}

.collapse-body {
  padding: 0 14px 14px;
  border-top: 1px solid var(--border-subtle);
  display: none;
  flex-direction: column;
  gap: 12px;
}
.collapse-body.open { display: flex; }
.collapse-desc {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.5;
}

/* Code blocks */
.code-section-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.7px;
  margin-bottom: 4px;
}
.code-block {
  background: var(--bg-deep);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  padding: 12px 14px;
  font-family: var(--font-mono);
  font-size: 12px;
  overflow-x: auto;
  white-space: pre;
  position: relative;
  line-height: 1.6;
}
.code-block code { background: none !important; padding: 0 !important; }
.code-block pre { margin: 0; background: none !important; }

.btn-copy {
  position: absolute;
  top: 8px;
  right: 8px;
  background: var(--bg-raised);
  border: 1px solid var(--border-default);
  color: var(--text-tertiary);
  padding: 3px 10px;
  font-size: 11px;
  border-radius: 4px;
  font-family: var(--font-body);
  opacity: 0;
  transition: all var(--transition-fast);
}
.code-block:hover .btn-copy { opacity: 1; }
.btn-copy:hover { color: var(--text-primary); border-color: var(--border-strong); }

/* JSON highlighting */
.json-key { color: var(--blue); }
.json-str { color: var(--green); }
.json-num { color: var(--accent); }
.json-bool { color: var(--red); }
.json-null { color: var(--red); }

/* ── Try it section ── */
.tryit-section {
  border-top: 1px solid var(--border-subtle);
  padding-top: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.tryit-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--accent);
  text-transform: uppercase;
  letter-spacing: 0.7px;
}
.tryit-fields {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.tryit-field { display: flex; flex-direction: column; gap: 4px; }
.tryit-field label { font-size: 12px; color: var(--text-secondary); font-weight: 500; }
.tryit-row { display: flex; gap: 8px; align-items: flex-end; }
.tryit-row .tryit-field { flex: 1; }

.tryit-actions {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}
.btn-tryit {
  background: var(--accent);
  color: var(--text-inverse);
  padding: 7px 16px;
  font-size: 12px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
  letter-spacing: 0.2px;
}
.btn-tryit:hover { background: var(--accent-bright); }
.btn-tryit:disabled { opacity: 0.4; cursor: not-allowed; }

.btn-cancel-sse {
  background: none;
  border: 1px solid var(--red);
  color: var(--red);
  padding: 6px 14px;
  font-size: 12px;
  border-radius: var(--radius-sm);
  font-weight: 500;
}
.btn-cancel-sse:hover { background: var(--red-dim); }

.btn-use-latest {
  background: none;
  border: 1px solid var(--border-default);
  color: var(--text-tertiary);
  padding: 5px 10px;
  font-size: 11px;
  border-radius: var(--radius-sm);
  white-space: nowrap;
  font-weight: 500;
}
.btn-use-latest:hover { border-color: var(--accent); color: var(--accent); }

.tryit-response {
  display: none;
  flex-direction: column;
  gap: 6px;
}
.tryit-response.visible { display: flex; }
.tryit-response-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.http-badge {
  display: inline-flex;
  align-items: center;
  padding: 2px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 700;
  font-family: var(--font-mono);
  letter-spacing: 0.3px;
}
.http-badge-2xx { background: var(--green-dim); color: var(--green); }
.http-badge-3xx { background: var(--blue-dim); color: var(--blue); }
.http-badge-4xx { background: var(--red-dim); color: var(--red); }
.http-badge-5xx { background: var(--red-dim); color: var(--red); }

.tryit-headers {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-tertiary);
  padding: 6px 10px;
  background: var(--bg-deep);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-sm);
}
.tryit-body {
  background: var(--bg-deep);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  padding: 12px 14px;
  font-family: var(--font-mono);
  font-size: 12px;
  max-height: 260px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.6;
}

/* Prism overrides */
code[class*="language-"], pre[class*="language-"] {
  background: transparent !important;
  font-family: var(--font-mono) !important;
  font-size: 12px !important;
  margin: 0;
  padding: 0;
}

/* ── Responsive ── */
@media (max-width: 700px) {
  .main { flex-direction: column; }
  .panel-left, .panel-right { width: 100% !important; }
  .panel-left { border-bottom: 1px solid var(--border-subtle); }
  .splitter { display: none; }
  .header { padding: 0 16px; gap: 12px; height: auto; padding: 12px 16px; flex-wrap: wrap; }
  .apikey-bar { max-width: 100%; }
  .logo-sub { display: none; }
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup-templating.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
</head>
<body>
<div class="app">

  <!-- Header -->
  <div class="header">
    <div class="logo">
      <div class="logo-icon">G</div>
      <div class="logo-text">ClaudeGate <span class="logo-sub">API Playground</span></div>
    </div>
    <div class="apikey-bar">
      <label>Key</label>
      <div class="apikey-wrap">
        <input type="password" id="apiKeyInput" placeholder="your-api-key" autocomplete="off" spellcheck="false">
        <button class="apikey-toggle" id="keyToggle" title="Show/hide key">&#128065;</button>
      </div>
      <div class="key-status" id="keyStatus" title="Key status"></div>
      <button class="btn-save" id="btnSave">Save</button>
    </div>
  </div>

  <div class="main">

    <!-- Left panel -->
    <div class="panel-left">

      <!-- Playground -->
      <div class="card">
        <div class="card-label">Playground</div>

        <div style="display:flex;flex-direction:column;gap:12px">
          <div class="row">
            <div class="field">
              <span class="field-label">Model</span>
              <select id="modelSelect">
                <option value="haiku">claude-haiku</option>
                <option value="sonnet">claude-sonnet</option>
                <option value="opus">claude-opus</option>
              </select>
            </div>
            <label class="checkbox-wrap">
              <input type="checkbox" id="jsonMode"> JSON mode
            </label>
          </div>

          <div class="field">
            <button class="system-toggle" id="systemToggleBtn">
              <span class="chevron-sm">&#9654;</span> System prompt <span style="color:var(--text-tertiary);font-weight:400">(optional)</span>
            </button>
            <textarea id="systemPrompt" class="collapsed" rows="3" placeholder="You are a helpful assistant."></textarea>
          </div>

          <div class="field">
            <span class="field-label">Prompt <span class="field-required">*</span></span>
            <textarea id="promptInput" rows="4" placeholder="Ask something..."></textarea>
          </div>

          <div>
            <button class="btn-send" id="btnSend">
              <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8h12M10 4l4 4-4 4"/></svg>
              Send
            </button>
          </div>

          <div class="response-area">
            <div class="response-meta">
              <span class="response-label">Response</span>
              <span id="statusBadge"></span>
              <span class="response-jobid" id="jobIdDisplay"></span>
            </div>
            <div class="response-box" id="responseBox"><span class="response-empty">Response will appear here...</span></div>
          </div>
        </div>
      </div>

      <!-- Job History -->
      <div class="card">
        <div class="history-header">
          <div class="card-label" style="margin-bottom:0">Job History</div>
          <button class="btn-refresh" id="btnRefresh">
            <svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 1v5h5M15 15v-5h-5"/><path d="M2.5 10A6 6 0 0113.3 4.3L15 6M13.5 6A6 6 0 012.7 11.7L1 10"/></svg>
            Refresh
          </button>
        </div>
        <div class="job-list" id="jobList">
          <div class="job-list-empty">No jobs yet.</div>
        </div>
      </div>

    </div>

    <!-- Splitter -->
    <div class="splitter" id="splitter"></div>

    <!-- Right panel -->
    <div class="panel-right">
      <div class="section-title">Getting Started</div>
      <div class="section-desc">From zero to running in 5 minutes.</div>
      <div id="gettingStarted"></div>

      <div class="section-title section-gap">API Documentation</div>
      <div id="apiDocs"></div>

      <div class="section-title section-gap">Integration Examples</div>
      <div class="section-desc">Ready-to-use code snippets for integrating ClaudeGate into your application.</div>
      <div id="integrationExamples"></div>
    </div>

  </div>
</div>

<script>
(function() {
'use strict';

var base = window.location.pathname.replace(/\/[^/]*$/, '').replace(/\/+$/, '');
function apiUrl(path) { return base + '/' + path.replace(/^\//, ''); }

// ── API Key ──
var keyInput = document.getElementById('apiKeyInput');
var keyStatus = document.getElementById('keyStatus');
var keyToggle = document.getElementById('keyToggle');
var btnSave = document.getElementById('btnSave');

var apiKey = localStorage.getItem('cg_api_key') || '';
keyInput.value = apiKey;

keyToggle.addEventListener('click', function() {
  var show = keyInput.type === 'password';
  keyInput.type = show ? 'text' : 'password';
  keyToggle.innerHTML = show ? '&#128064;' : '&#128065;';
});

btnSave.addEventListener('click', function() {
  apiKey = keyInput.value.trim();
  localStorage.setItem('cg_api_key', apiKey);
  btnSave.textContent = 'Saved!';
  setTimeout(function() { btnSave.textContent = 'Save'; }, 1500);
  validateKey();
});

keyInput.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') btnSave.click();
});

function validateKey() {
  if (!apiKey) { setKeyStatus(null); return; }
  fetch(apiUrl('api/v1/jobs?limit=1'), { headers: { 'X-API-Key': apiKey } })
    .then(function(r) { setKeyStatus(r.ok); })
    .catch(function() { setKeyStatus(false); });
}

function setKeyStatus(valid) {
  keyStatus.className = 'key-status' + (valid === true ? ' valid' : valid === false ? ' invalid' : '');
  keyStatus.title = valid === true ? 'Key valid' : valid === false ? 'Key invalid or server unreachable' : 'Not validated';
}

if (apiKey) validateKey();

// ── Helpers ──
function authHeaders(extra) {
  return Object.assign({ 'X-API-Key': apiKey }, extra || {});
}

function timeAgo(dateStr) {
  var diff = Math.floor((Date.now() - new Date(dateStr)) / 1000);
  if (diff < 60) return diff + 's ago';
  if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
  if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
  return Math.floor(diff / 86400) + 'd ago';
}

function badgeHTML(status) {
  return '<span class="badge badge-' + status + '">' + status + '</span>';
}

function escapeHTML(str) {
  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

function highlightJSON(str) {
  return str
    .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
    .replace(/("(?:[^"\\]|\\.)*")\s*:/g, '<span class="json-key">$1</span>:')
    .replace(/:\s*("(?:[^"\\]|\\.)*")/g, ': <span class="json-str">$1</span>')
    .replace(/:\s*(-?\d+(?:\.\d+)?)/g, ': <span class="json-num">$1</span>')
    .replace(/:\s*(true|false)/g, ': <span class="json-bool">$1</span>')
    .replace(/:\s*(null)/g, ': <span class="json-null">$1</span>');
}

// ── System prompt toggle ──
var systemToggleBtn = document.getElementById('systemToggleBtn');
var systemPrompt = document.getElementById('systemPrompt');
var systemOpen = false;

systemToggleBtn.addEventListener('click', function() {
  systemOpen = !systemOpen;
  systemPrompt.classList.toggle('collapsed', !systemOpen);
  systemToggleBtn.classList.toggle('open', systemOpen);
});

// ── Playground ──
var promptInput = document.getElementById('promptInput');
var modelSelect = document.getElementById('modelSelect');
var btnSend = document.getElementById('btnSend');
var responseBox = document.getElementById('responseBox');
var statusBadgeEl = document.getElementById('statusBadge');
var jobIdDisplay = document.getElementById('jobIdDisplay');
var activeSSE = null;

btnSend.addEventListener('click', sendJob);

function sendJob() {
  var prompt = promptInput.value.trim();
  if (!prompt) { promptInput.focus(); return; }
  if (!apiKey) { alert('Please enter and save your API key first.'); return; }

  if (activeSSE) { activeSSE.abort(); activeSSE = null; }

  btnSend.disabled = true;
  responseBox.innerHTML = '';
  statusBadgeEl.innerHTML = badgeHTML('queued');
  jobIdDisplay.textContent = '';

  var body = { prompt: prompt, model: modelSelect.value };
  var sp = systemPrompt.value.trim();
  if (sp) body.system_prompt = sp;
  if (document.getElementById('jsonMode').checked) body.response_format = 'json';

  fetch(apiUrl('api/v1/jobs'), {
    method: 'POST',
    headers: authHeaders({ 'Content-Type': 'application/json' }),
    body: JSON.stringify(body)
  }).then(function(r) {
    if (!r.ok) return r.json().catch(function() { return { error: r.statusText }; }).then(function(e) {
      showError('Failed to create job: ' + (e.error || r.statusText));
      btnSend.disabled = false;
    });
    return r.json().then(function(job) {
      jobIdDisplay.textContent = '#' + job.job_id.slice(0, 8);
      openSSE(job.job_id);
    });
  }).catch(function(e) {
    showError('Network error: ' + e.message);
    btnSend.disabled = false;
  });
}

function openSSE(jobId) {
  var ctrl = new AbortController();
  activeSSE = ctrl;

  fetch(apiUrl('api/v1/jobs/' + jobId + '/sse'), { headers: authHeaders(), signal: ctrl.signal })
    .then(function(r) {
      if (!r.ok) return r.json().then(function(e) { throw new Error(e.error || r.statusText); });
      var reader = r.body.getReader();
      var decoder = new TextDecoder();
      var buf = '';

      function pump() {
        reader.read().then(function(chunk) {
          if (chunk.done) { btnSend.disabled = false; loadHistory(); return; }
          buf += decoder.decode(chunk.value, { stream: true });
          var parts = buf.split('\n\n');
          buf = parts.pop();
          parts.forEach(parseSSEChunk);
          pump();
        }).catch(function(e) {
          if (e.name !== 'AbortError') showError('Stream error: ' + e.message);
          btnSend.disabled = false;
          loadHistory();
        });
      }
      pump();
    })
    .catch(function(e) {
      if (e.name !== 'AbortError') showError('SSE error: ' + e.message);
      btnSend.disabled = false;
    });
}

function parseSSEChunk(raw) {
  var lines = raw.split('\n');
  var eventName = '', dataStr = '';
  for (var k = 0; k < lines.length; k++) {
    if (lines[k].startsWith('event: ')) eventName = lines[k].slice(7).trim();
    else if (lines[k].startsWith('data: ')) dataStr = lines[k].slice(6).trim();
  }
  if (!dataStr) return;
  var data;
  try { data = JSON.parse(dataStr); } catch (e) { return; }

  if (eventName === 'status') {
    statusBadgeEl.innerHTML = badgeHTML(data.status || 'queued');
  } else if (eventName === 'chunk') {
    var chunk = data.chunk || data.text || data;
    if (typeof chunk === 'string') {
      if (!responseBox.dataset.streaming) {
        responseBox.textContent = '';
        responseBox.dataset.streaming = '1';
      }
      responseBox.textContent += chunk;
      responseBox.scrollTop = responseBox.scrollHeight;
    }
  } else if (eventName === 'result') {
    delete responseBox.dataset.streaming;
    statusBadgeEl.innerHTML = badgeHTML(data.status || 'completed');
    if (data.result) {
      if (document.getElementById('jsonMode').checked) {
        try { responseBox.textContent = JSON.stringify(JSON.parse(data.result), null, 2); }
        catch (e) { responseBox.textContent = data.result; }
      } else {
        responseBox.textContent = data.result;
      }
    } else if (data.error) {
      responseBox.textContent = 'Error: ' + data.error;
    }
    responseBox.scrollTop = responseBox.scrollHeight;
    btnSend.disabled = false;
    if (activeSSE) { activeSSE.abort(); activeSSE = null; }
    loadHistory();
  }
}

function showError(msg) {
  statusBadgeEl.innerHTML = badgeHTML('failed');
  responseBox.textContent = msg;
}

function showJobResult(job) {
  jobIdDisplay.textContent = '#' + job.job_id.slice(0, 8);
  statusBadgeEl.innerHTML = badgeHTML(job.status);
  if (job.result) {
    responseBox.textContent = job.result;
  } else if (job.error) {
    responseBox.textContent = 'Error: ' + job.error;
  } else {
    responseBox.textContent = job.status === 'queued' ? 'Job is queued...' : job.status === 'cancelled' ? 'Job was cancelled.' : 'Processing...';
  }
}

// ── Job History ──
var jobList = document.getElementById('jobList');
var btnRefresh = document.getElementById('btnRefresh');
btnRefresh.addEventListener('click', loadHistory);

function loadHistory() {
  if (!apiKey) return;
  fetch(apiUrl('api/v1/jobs?limit=10'), { headers: authHeaders() })
    .then(function(r) { if (!r.ok) return; return r.json(); })
    .then(function(data) {
      if (!data) return;
      renderHistory(data.jobs || []);
      setKeyStatus(true);
    })
    .catch(function(e) { console.error('Failed to load history:', e); });
}

function renderHistory(jobs) {
  if (!jobs.length) {
    jobList.innerHTML = '<div class="job-list-empty">No jobs yet.</div>';
    return;
  }
  jobList.innerHTML = '';
  jobs.forEach(function(job) {
    var item = document.createElement('div');
    item.className = 'job-item';
    var isTerminal = job.status === 'completed' || job.status === 'failed' || job.status === 'cancelled';
    item.innerHTML =
      '<span class="job-id-short">#' + job.job_id.slice(0, 8) + '</span>' +
      '<span class="job-model">' + job.model + '</span>' +
      badgeHTML(job.status) +
      '<span class="job-time">' + timeAgo(job.created_at) + '</span>' +
      (!isTerminal ? '<button class="btn-action-sm" data-cancel="' + job.job_id + '" title="Cancel">&#9632;</button>' : '') +
      '<button class="btn-action-sm danger" data-delete="' + job.job_id + '" title="Delete">&#128465;</button>';

    var cancelBtn = item.querySelector('[data-cancel]');
    if (cancelBtn) {
      cancelBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        cancelJob(job.job_id);
      });
    }
    item.querySelector('[data-delete]').addEventListener('click', function(e) {
      e.stopPropagation();
      deleteJob(job.job_id);
    });
    item.addEventListener('click', function() { showJobResult(job); });
    jobList.appendChild(item);
  });
}

function deleteJob(id) {
  fetch(apiUrl('api/v1/jobs/' + id), { method: 'DELETE', headers: authHeaders() })
    .catch(function(e) { console.error('Failed to delete job:', e); })
    .then(loadHistory);
}

function cancelJob(id) {
  fetch(apiUrl('api/v1/jobs/' + id + '/cancel'), { method: 'POST', headers: authHeaders() })
    .catch(function(e) { console.error('Failed to cancel job:', e); })
    .then(loadHistory);
}

// ── Getting Started ──
var steps = [
  { label: '1', title: 'Install Claude Code CLI', code: '# Requires Node.js 18+\nnpm install -g @anthropic-ai/claude-code\n\n# Authenticate with your Anthropic account\nclaude' },
  { label: '2', title: 'Install Go', code: '# Install mise (version manager)\ncurl https://mise.run | sh\necho \'eval \"$(~/.local/bin/mise activate bash)\"\' >> ~/.bashrc\nsource ~/.bashrc\n\n# Install Go\nmise use -g go@latest' },
  { label: '3', title: 'Build', code: 'git clone https://github.com/ohugonnot/claudegate.git\ncd claudegate\nmake build' },
  { label: '4', title: 'Configure', code: 'cp .env.example .env\n# Edit .env \u2014 set at minimum:\n#   CLAUDEGATE_API_KEYS=<your-secret-key>\n#   CLAUDEGATE_CLAUDE_PATH=$(which claude)' },
  { label: '5', title: 'Run & Test', code: './bin/claudegate\n\n# Test: curl http://localhost:8080/api/v1/health\n# Then open http://localhost:8080/ in your browser' },
  { label: '6', title: 'Reverse Proxy (optional)', code: '# Bind to localhost in .env:\n#   CLAUDEGATE_LISTEN_ADDR=127.0.0.1:8080\n\n# \u2500\u2500 Apache \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# sudo a2enmod proxy proxy_http headers\n# Add to your VirtualHost:\nProxyPass        /claudegate/ http://127.0.0.1:8080/ flushpackets=on\nProxyPassReverse /claudegate/ http://127.0.0.1:8080/\n\n# \u2500\u2500 Nginx \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# Add to your server block:\nlocation /claudegate/ {\n    proxy_pass http://127.0.0.1:8080/;\n    proxy_buffering off;  # critical for SSE\n    proxy_cache off;\n    proxy_read_timeout 300s;\n}\n\n# \u2500\u2500 Caddy \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# handle_path /claudegate/* {\n#     reverse_proxy localhost:8080\n# }' }
];

function buildGuide() {
  var container = document.getElementById('gettingStarted');
  steps.forEach(function(step, i) {
    var div = document.createElement('div');
    div.className = 'collapse-item';
    div.innerHTML =
      '<div class="collapse-head">' +
        '<span class="method-badge method-step">' + step.label + '</span>' +
        '<span class="collapse-path non-mono">' + step.title + '</span>' +
        '<span class="collapse-chevron">&#9654;</span>' +
      '</div>' +
      '<div class="collapse-body">' +
        '<div class="code-block"><button class="btn-copy">Copy</button><pre><code class="language-bash">' + escapeHTML(step.code) + '</code></pre></div>' +
      '</div>';

    div.querySelector('.collapse-head').addEventListener('click', function() {
      var body = div.querySelector('.collapse-body');
      var chev = div.querySelector('.collapse-chevron');
      var open = body.classList.toggle('open');
      chev.style.transform = open ? 'rotate(90deg)' : '';
    });

    div.querySelector('.btn-copy').addEventListener('click', function(e) {
      e.stopPropagation();
      navigator.clipboard.writeText(step.code).then(function() {
        e.target.textContent = 'Copied!';
        setTimeout(function() { e.target.textContent = 'Copy'; }, 1500);
      }).catch(function() {});
    });

    container.appendChild(div);
  });
}

// ── API Documentation ──
var endpoints = [
  {
    method: 'POST', path: '/api/v1/jobs',
    desc: 'Submit a new job. Returns 202 Accepted.<br><br>' +
'<strong>Parameters:</strong><br>' +
'<code>prompt</code> <em>(required)</em> — text prompt to send to Claude<br>' +
'<code>model</code> — haiku (default), sonnet, or opus<br>' +
'<code>system_prompt</code> — custom system instruction<br>' +
'<code>callback_url</code> — webhook URL, receives the result when done<br>' +
'<code>response_format</code> — text (default) or json<br>' +
'<code>metadata</code> — arbitrary JSON, returned as-is',
    curl: "curl -X POST https://example.com/api/v1/jobs \\\n  -H \"X-API-Key: your-key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"prompt\": \"Explain what a mutex is.\", \"model\": \"haiku\", \"system_prompt\": \"Be concise.\", \"response_format\": \"json\", \"callback_url\": \"https://example.com/webhook\", \"metadata\": {\"user_id\": 42}}'",
    response: '{\n  "job_id": "a1b2c3d4-e5f6-...",\n  "prompt": "Explain what a mutex is.",\n  "model": "haiku",\n  "status": "queued",\n  "response_format": "json",\n  "metadata": {"user_id": 42},\n  "created_at": "2025-01-01T00:00:00Z"\n}',
    tryit: { type: 'post-job' }
  },
  {
    method: 'GET', path: '/api/v1/jobs',
    desc: 'List jobs with pagination. Returns 200 OK.<br><br>' +
'<strong>Query parameters:</strong><br>' +
'<code>limit</code> — number of jobs to return, default 20 (max 100)<br>' +
'<code>offset</code> — number of jobs to skip, default 0',
    curl: "curl \"https://example.com/api/v1/jobs?limit=10&offset=0\" \\\n  -H \"X-API-Key: your-key\"",
    response: '{\n  "jobs": [ { "job_id": "...", "status": "completed", ... } ],\n  "total": 42,\n  "limit": 10,\n  "offset": 0\n}',
    tryit: { type: 'list-jobs' }
  },
  {
    method: 'GET', path: '/api/v1/jobs/{id}',
    desc: 'Poll a job\'s status and result. Returns 200 OK or 404 if not found.<br><br>' +
'<strong>Path parameters:</strong><br>' +
'<code>id</code> <em>(required)</em> — job UUID returned by the POST endpoint',
    curl: "curl \"https://example.com/api/v1/jobs/a1b2c3d4-...\" \\\n  -H \"X-API-Key: your-key\"",
    response: '{\n  "job_id": "a1b2c3d4-...",\n  "model": "haiku",\n  "status": "completed",\n  "result": "A mutex ensures exclusive access to a shared resource.",\n  "created_at": "2025-01-01T00:00:00Z",\n  "started_at": "2025-01-01T00:00:00.1Z",\n  "completed_at": "2025-01-01T00:00:02Z"\n}',
    tryit: { type: 'get-job' }
  },
  {
    method: 'GET', path: '/api/v1/jobs/{id}/sse',
    desc: 'Stream job progress via Server-Sent Events. Connection closes when job finishes.<br><br>' +
'<strong>Path parameters:</strong><br>' +
'<code>id</code> <em>(required)</em> — job UUID to stream<br><br>' +
'<strong>Events:</strong> status, chunk, result',
    curl: "curl -N \"https://example.com/api/v1/jobs/a1b2c3d4-.../sse\" \\\n  -H \"X-API-Key: your-key\"",
    response: 'event: status\ndata: {"job_id":"...","status":"processing"}\n\nevent: chunk\ndata: {"text":"A mutex "}\n\nevent: result\ndata: {"job_id":"...","status":"completed","result":"A mutex..."}',
    tryit: { type: 'sse-job' }
  },
  {
    method: 'DELETE', path: '/api/v1/jobs/{id}',
    desc: 'Delete a job record. Returns 204 No Content or 404 if not found.<br><br>' +
'<strong>Path parameters:</strong><br>' +
'<code>id</code> <em>(required)</em> — job UUID to delete',
    curl: "curl -X DELETE \"https://example.com/api/v1/jobs/a1b2c3d4-...\" \\\n  -H \"X-API-Key: your-key\"",
    response: 'HTTP/1.1 204 No Content',
    tryit: { type: 'delete-job' }
  },
  {
    method: 'POST', path: '/api/v1/jobs/{id}/cancel',
    desc: 'Cancel a queued or processing job. Returns 200 OK or 409 Conflict if already terminal.<br><br>' +
'<strong>Path parameters:</strong><br>' +
'<code>id</code> <em>(required)</em> — job UUID to cancel',
    curl: "curl -X POST \"https://example.com/api/v1/jobs/a1b2c3d4-.../cancel\" \\\n  -H \"X-API-Key: your-key\"",
    response: '{\n  "status": "cancelled"\n}',
    tryit: { type: 'cancel-job' }
  },
  {
    method: 'GET', path: '/api/v1/health',
    desc: 'Health check. No authentication required.',
    curl: 'curl "https://example.com/api/v1/health"',
    response: '{"status": "ok"}',
    tryit: { type: 'health' }
  }
];

function buildTryitHTML(ep, i) {
  var t = ep.tryit.type;
  var fields = '';

  if (t === 'post-job') {
    fields =
      '<div class="tryit-field">' +
        '<label>prompt <span style="color:var(--red)">*</span></label>' +
        '<textarea id="ti-' + i + '-prompt" rows="3" placeholder="Ask something..."></textarea>' +
      '</div>' +
      '<div class="tryit-row">' +
        '<div class="tryit-field"><label>model</label><select id="ti-' + i + '-model"><option value="haiku">claude-haiku</option><option value="sonnet">claude-sonnet</option><option value="opus">claude-opus</option></select></div>' +
        '<div class="tryit-field"><label>system_prompt</label><input type="text" id="ti-' + i + '-system" placeholder="optional"></div>' +
        '<label class="checkbox-wrap" style="padding-bottom:9px"><input type="checkbox" id="ti-' + i + '-json"> JSON</label>' +
      '</div>';
  } else if (t === 'list-jobs') {
    fields =
      '<div class="tryit-row">' +
        '<div class="tryit-field"><label>limit</label><input type="number" id="ti-' + i + '-limit" value="20" min="1" max="100"></div>' +
        '<div class="tryit-field"><label>offset</label><input type="number" id="ti-' + i + '-offset" value="0" min="0"></div>' +
      '</div>';
  } else if (t === 'get-job' || t === 'sse-job' || t === 'delete-job' || t === 'cancel-job') {
    fields =
      '<div class="tryit-field"><label>job_id</label>' +
        '<div style="display:flex;gap:6px">' +
          '<input type="text" id="ti-' + i + '-jobid" placeholder="a1b2c3d4-e5f6-..." style="flex:1">' +
          '<button class="btn-use-latest" id="ti-' + i + '-latest">Use latest</button>' +
        '</div>' +
      '</div>';
  }

  var cancelBtn = t === 'sse-job' ? '<button class="btn-cancel-sse" id="ti-' + i + '-cancel" style="display:none">&#9632; Cancel</button>' : '';

  return '<div class="tryit-section">' +
    '<div class="tryit-label">Try it</div>' +
    (fields ? '<div class="tryit-fields">' + fields + '</div>' : '') +
    '<div class="tryit-actions">' +
      '<button class="btn-tryit" id="ti-' + i + '-btn">&#9654; Send Request</button>' +
      cancelBtn +
    '</div>' +
    '<div class="tryit-response" id="ti-' + i + '-resp">' +
      '<div class="tryit-response-meta">' +
        '<span id="ti-' + i + '-status-badge"></span>' +
        '<div class="tryit-headers" id="ti-' + i + '-headers" style="display:none"></div>' +
      '</div>' +
      '<div class="tryit-body" id="ti-' + i + '-body"></div>' +
    '</div>' +
  '</div>';
}

function getLatestJobId() {
  var btn = jobList.querySelector('[data-delete]');
  return btn ? btn.dataset.delete : '';
}

function httpBadgeHTML(status) {
  var cls = 'http-badge-5xx';
  if (status >= 200 && status < 300) cls = 'http-badge-2xx';
  else if (status >= 300 && status < 400) cls = 'http-badge-3xx';
  else if (status >= 400 && status < 500) cls = 'http-badge-4xx';
  return '<span class="http-badge ' + cls + '">HTTP ' + status + '</span>';
}

function showTryitResponse(i, statusCode, headersText, bodyHTML) {
  var resp = document.getElementById('ti-' + i + '-resp');
  document.getElementById('ti-' + i + '-status-badge').innerHTML = httpBadgeHTML(statusCode);
  var headersEl = document.getElementById('ti-' + i + '-headers');
  if (headersText) { headersEl.textContent = headersText; headersEl.style.display = ''; }
  else { headersEl.style.display = 'none'; }
  document.getElementById('ti-' + i + '-body').innerHTML = bodyHTML;
  resp.classList.add('visible');
}

function extractHeaders(r) {
  var parts = [];
  var ct = r.headers.get('Content-Type');
  var rid = r.headers.get('X-Request-ID');
  if (ct) parts.push('Content-Type: ' + ct);
  if (rid) parts.push('X-Request-ID: ' + rid);
  return parts.join('\n');
}

function tryitSend(ep, i) {
  var t = ep.tryit.type;
  var btn = document.getElementById('ti-' + i + '-btn');
  var bodyEl = document.getElementById('ti-' + i + '-body');
  var resp = document.getElementById('ti-' + i + '-resp');

  if (!apiKey && t !== 'health') { alert('Please enter and save your API key first.'); return; }
  btn.disabled = true;

  if (t === 'post-job') {
    var prompt = document.getElementById('ti-' + i + '-prompt').value.trim();
    if (!prompt) { document.getElementById('ti-' + i + '-prompt').focus(); btn.disabled = false; return; }
    var body = { prompt: prompt, model: document.getElementById('ti-' + i + '-model').value };
    var sp = document.getElementById('ti-' + i + '-system').value.trim();
    if (sp) body.system_prompt = sp;
    if (document.getElementById('ti-' + i + '-json').checked) body.response_format = 'json';
    fetch(apiUrl('api/v1/jobs'), { method: 'POST', headers: authHeaders({ 'Content-Type': 'application/json' }), body: JSON.stringify(body) })
      .then(function(r) { var hdr = extractHeaders(r); return r.text().then(function(txt) {
        var h; try { h = highlightJSON(JSON.stringify(JSON.parse(txt), null, 2)); } catch(e) { h = escapeHTML(txt); }
        showTryitResponse(i, r.status, hdr, h); btn.disabled = false; if (r.ok) loadHistory();
      }); })
      .catch(function(e) { resp.classList.add('visible'); bodyEl.textContent = 'Network error: ' + e.message; btn.disabled = false; });

  } else if (t === 'list-jobs') {
    var limit = document.getElementById('ti-' + i + '-limit').value || '20';
    var offset = document.getElementById('ti-' + i + '-offset').value || '0';
    fetch(apiUrl('api/v1/jobs?limit=' + limit + '&offset=' + offset), { headers: authHeaders() })
      .then(function(r) { var hdr = extractHeaders(r); return r.text().then(function(txt) {
        var h; try { h = highlightJSON(JSON.stringify(JSON.parse(txt), null, 2)); } catch(e) { h = escapeHTML(txt); }
        showTryitResponse(i, r.status, hdr, h); btn.disabled = false;
      }); })
      .catch(function(e) { resp.classList.add('visible'); bodyEl.textContent = 'Network error: ' + e.message; btn.disabled = false; });

  } else if (t === 'get-job') {
    var jobId = document.getElementById('ti-' + i + '-jobid').value.trim();
    if (!jobId) { document.getElementById('ti-' + i + '-jobid').focus(); btn.disabled = false; return; }
    fetch(apiUrl('api/v1/jobs/' + jobId), { headers: authHeaders() })
      .then(function(r) { var hdr = extractHeaders(r); return r.text().then(function(txt) {
        var h; try { h = highlightJSON(JSON.stringify(JSON.parse(txt), null, 2)); } catch(e) { h = escapeHTML(txt); }
        showTryitResponse(i, r.status, hdr, h); btn.disabled = false;
      }); })
      .catch(function(e) { resp.classList.add('visible'); bodyEl.textContent = 'Network error: ' + e.message; btn.disabled = false; });

  } else if (t === 'delete-job') {
    var jobId = document.getElementById('ti-' + i + '-jobid').value.trim();
    if (!jobId) { document.getElementById('ti-' + i + '-jobid').focus(); btn.disabled = false; return; }
    fetch(apiUrl('api/v1/jobs/' + jobId), { method: 'DELETE', headers: authHeaders() })
      .then(function(r) { var hdr = extractHeaders(r); return r.text().then(function(txt) {
        var b = r.status === 204 ? '(no content)' : (txt || '');
        showTryitResponse(i, r.status, hdr, escapeHTML(b)); btn.disabled = false; if (r.ok) loadHistory();
      }); })
      .catch(function(e) { resp.classList.add('visible'); bodyEl.textContent = 'Network error: ' + e.message; btn.disabled = false; });

  } else if (t === 'cancel-job') {
    var jobId = document.getElementById('ti-' + i + '-jobid').value.trim();
    if (!jobId) { document.getElementById('ti-' + i + '-jobid').focus(); btn.disabled = false; return; }
    fetch(apiUrl('api/v1/jobs/' + jobId + '/cancel'), { method: 'POST', headers: authHeaders() })
      .then(function(r) { var hdr = extractHeaders(r); return r.text().then(function(txt) {
        var h; try { h = highlightJSON(JSON.stringify(JSON.parse(txt), null, 2)); } catch(e) { h = escapeHTML(txt); }
        showTryitResponse(i, r.status, hdr, h); btn.disabled = false; if (r.ok) loadHistory();
      }); })
      .catch(function(e) { resp.classList.add('visible'); bodyEl.textContent = 'Network error: ' + e.message; btn.disabled = false; });

  } else if (t === 'sse-job') {
    var jobId = document.getElementById('ti-' + i + '-jobid').value.trim();
    if (!jobId) { document.getElementById('ti-' + i + '-jobid').focus(); btn.disabled = false; return; }
    var cancelBtn = document.getElementById('ti-' + i + '-cancel');
    cancelBtn.style.display = '';
    resp.classList.add('visible');
    bodyEl.innerHTML = '';
    document.getElementById('ti-' + i + '-status-badge').innerHTML = '';
    document.getElementById('ti-' + i + '-headers').style.display = 'none';

    var ctrl = new AbortController();
    cancelBtn.onclick = function() { ctrl.abort(); cancelBtn.style.display = 'none'; btn.disabled = false; };

    fetch(apiUrl('api/v1/jobs/' + jobId + '/sse'), { headers: authHeaders(), signal: ctrl.signal })
      .then(function(r) {
        document.getElementById('ti-' + i + '-status-badge').innerHTML = httpBadgeHTML(r.status);
        var hdr = extractHeaders(r);
        if (hdr) { var hdEl = document.getElementById('ti-' + i + '-headers'); hdEl.textContent = hdr; hdEl.style.display = ''; }
        if (!r.ok) return r.text().then(function(txt) { bodyEl.textContent = txt || r.statusText; cancelBtn.style.display = 'none'; btn.disabled = false; });
        var reader = r.body.getReader();
        var decoder = new TextDecoder();
        var buf = '';
        function pump() {
          reader.read().then(function(chunk) {
            if (chunk.done) { cancelBtn.style.display = 'none'; btn.disabled = false; return; }
            buf += decoder.decode(chunk.value, { stream: true });
            var parts = buf.split('\n\n');
            buf = parts.pop();
            parts.forEach(function(raw) {
              var lines = raw.split('\n'), eventName = '', dataStr = '';
              lines.forEach(function(line) {
                if (line.startsWith('event: ')) eventName = line.slice(7).trim();
                else if (line.startsWith('data: ')) dataStr = line.slice(6).trim();
              });
              if (!dataStr) return;
              var label = document.createElement('div');
              label.style.cssText = 'color:var(--text-tertiary);font-size:11px;margin-top:6px';
              label.textContent = 'event: ' + eventName;
              var pre = document.createElement('div');
              try { pre.innerHTML = highlightJSON(JSON.stringify(JSON.parse(dataStr), null, 2)); }
              catch(e) { pre.textContent = dataStr; }
              bodyEl.appendChild(label);
              bodyEl.appendChild(pre);
              bodyEl.scrollTop = bodyEl.scrollHeight;
            });
            pump();
          }).catch(function(e) {
            if (e.name !== 'AbortError') { var d = document.createElement('div'); d.style.color = 'var(--red)'; d.textContent = 'Stream error: ' + e.message; bodyEl.appendChild(d); }
            cancelBtn.style.display = 'none'; btn.disabled = false;
          });
        }
        pump();
      }).catch(function(e) {
        if (e.name !== 'AbortError') bodyEl.textContent = 'SSE error: ' + e.message;
        cancelBtn.style.display = 'none'; btn.disabled = false;
      });

  } else if (t === 'health') {
    fetch(apiUrl('api/v1/health'))
      .then(function(r) { var hdr = extractHeaders(r); return r.text().then(function(txt) {
        var h; try { h = highlightJSON(JSON.stringify(JSON.parse(txt), null, 2)); } catch(e) { h = escapeHTML(txt); }
        showTryitResponse(i, r.status, hdr, h); btn.disabled = false;
      }); })
      .catch(function(e) { resp.classList.add('visible'); bodyEl.textContent = 'Network error: ' + e.message; btn.disabled = false; });
  }
}

function buildDocs() {
  var container = document.getElementById('apiDocs');
  endpoints.forEach(function(ep, i) {
    var div = document.createElement('div');
    div.className = 'collapse-item';
    var mClass = 'method-' + ep.method.toLowerCase();
    div.innerHTML =
      '<div class="collapse-head">' +
        '<span class="method-badge ' + mClass + '">' + ep.method + '</span>' +
        '<span class="collapse-path">' + ep.path + '</span>' +
        '<span class="collapse-chevron">&#9654;</span>' +
      '</div>' +
      '<div class="collapse-body">' +
        '<div class="collapse-desc">' + ep.desc + '</div>' +
        '<div><div class="code-section-label">curl example</div><div class="code-block"><button class="btn-copy" data-copy="' + i + '">Copy</button><code>' + escapeHTML(ep.curl) + '</code></div></div>' +
        '<div><div class="code-section-label">example response</div><div class="code-block"><code>' + highlightJSON(ep.response) + '</code></div></div>' +
        buildTryitHTML(ep, i) +
      '</div>';

    div.querySelector('.collapse-head').addEventListener('click', function() {
      var body = div.querySelector('.collapse-body');
      var chev = div.querySelector('.collapse-chevron');
      var open = body.classList.toggle('open');
      chev.style.transform = open ? 'rotate(90deg)' : '';
    });

    div.querySelector('.btn-copy').addEventListener('click', function(e) {
      e.stopPropagation();
      var idx = parseInt(e.target.dataset.copy);
      navigator.clipboard.writeText(endpoints[idx].curl).then(function() {
        e.target.textContent = 'Copied!';
        setTimeout(function() { e.target.textContent = 'Copy'; }, 1500);
      }).catch(function() {});
    });

    var tryBtn = div.querySelector('#ti-' + i + '-btn');
    if (tryBtn) tryBtn.addEventListener('click', function(e) { e.stopPropagation(); tryitSend(ep, i); });

    var latestBtn = div.querySelector('#ti-' + i + '-latest');
    if (latestBtn) latestBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      var id = getLatestJobId();
      if (id) document.getElementById('ti-' + i + '-jobid').value = id;
      else alert('No jobs in history yet.');
    });

    container.appendChild(div);
  });
}

// ── Integration Examples ──
var examples = [
  {
    label: 'SSE Streaming', lang: 'JavaScript', lang_class: 'javascript',
    code: "// Submit a job then stream the response in real-time\n// Works in both browser and Node.js (Node 18+)\n\nconst BASE_URL = 'https://example.com';\nconst API_KEY  = 'your-api-key';\n\nasync function streamJob(prompt) {\n  // 1. Create the job\n  const createRes = await fetch(`${BASE_URL}/api/v1/jobs`, {\n    method: 'POST',\n    headers: {\n      'X-API-Key': API_KEY,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ prompt, model: 'haiku' })\n  });\n  if (!createRes.ok) throw new Error('Job creation failed: ' + createRes.status);\n  const { job_id } = await createRes.json();\n\n  // 2. Open SSE stream \u2014 EventSource cannot send custom headers,\n  //    so we use fetch + ReadableStream instead.\n  const sseRes = await fetch(`${BASE_URL}/api/v1/jobs/${job_id}/sse`, {\n    headers: { 'X-API-Key': API_KEY }\n  });\n  if (!sseRes.ok) throw new Error('SSE connect failed: ' + sseRes.status);\n\n  const reader  = sseRes.body.getReader();\n  const decoder = new TextDecoder();\n  let buf = '';\n\n  try {\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n      buf += decoder.decode(value, { stream: true });\n      const messages = buf.split('\\n\\n');\n      buf = messages.pop(); // keep incomplete tail\n\n      for (const msg of messages) {\n        const eventLine = msg.split('\\n').find(l => l.startsWith('event: '));\n        const dataLine  = msg.split('\\n').find(l => l.startsWith('data: '));\n        if (!dataLine) continue;\n        const event = eventLine ? eventLine.slice(7).trim() : '';\n        const data  = JSON.parse(dataLine.slice(6));\n\n        if (event === 'chunk')  process.stdout.write(data.text || '');\n        if (event === 'result') { console.log('\\nDone:', data.status); return; }\n      }\n    }\n  } catch (err) {\n    // Network drop or parse error \u2014 surface to caller\n    throw new Error('SSE stream error: ' + err.message);\n  } finally {\n    reader.cancel();\n  }\n}\n\nstreamJob('Explain what a mutex is.').catch(console.error);"
  },
  {
    label: 'Polling + Webhook', lang: 'Python', lang_class: 'python',
    code: "# pip install httpx\n# Async polling example \u2014 swap the poller for a webhook receiver in production.\n\nimport asyncio\nimport httpx\n\nBASE_URL = 'https://example.com'\nAPI_KEY  = 'your-api-key'\n\nHEADERS = {'X-API-Key': API_KEY}\n\nTERMINAL_STATUSES = {'completed', 'failed', 'cancelled'}\n\n\nasync def create_job(client: httpx.AsyncClient, prompt: str, model: str = 'haiku') -> str:\n    resp = await client.post(\n        f'{BASE_URL}/api/v1/jobs',\n        json={'prompt': prompt, 'model': model},\n    )\n    resp.raise_for_status()\n    return resp.json()['job_id']\n\n\nasync def poll_until_done(\n    client: httpx.AsyncClient,\n    job_id: str,\n    interval: float = 1.0,\n) -> dict:\n    url = f'{BASE_URL}/api/v1/jobs/{job_id}'\n    while True:\n        resp = await client.get(url)\n        resp.raise_for_status()\n        job = resp.json()\n        if job['status'] in TERMINAL_STATUSES:\n            return job\n        await asyncio.sleep(interval)\n\n\nasync def main() -> None:\n    async with httpx.AsyncClient(headers=HEADERS, timeout=30.0) as client:\n        job_id = await create_job(client, 'Summarise the theory of relativity in 3 sentences.')\n        print(f'Job queued: {job_id}')\n\n        job = await poll_until_done(client, job_id)\n\n        if job['status'] == 'completed':\n            print(job['result'])\n        else:\n            raise RuntimeError(f'Job failed: {job.get(\"error\")}')\n\n\n# \u2500\u2500 Webhook alternative (Flask) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# from flask import Flask, request\n# app = Flask(__name__)\n#\n# @app.post('/webhook/claudegate')\n# def webhook():\n#     payload = request.get_json(force=True)\n#     job_id, status, result = payload['job_id'], payload['status'], payload.get('result')\n#     if status == 'completed':\n#         print(f'[webhook] {job_id}: {result}')\n#     else:\n#         print(f'[webhook] {job_id} failed: {payload.get(\"error\")}')\n#     return '', 200  # always ACK quickly\n\n\nif __name__ == '__main__':\n    asyncio.run(main())"
  },
  {
    label: 'Webhook', lang: 'Node.js / Express', lang_class: 'javascript',
    code: "// Express server that submits a job and receives the result via webhook.\n// Run: npm install express && node server.js\n\nimport express from 'express';\n\nconst BASE_URL     = 'https://example.com';\nconst API_KEY      = 'your-api-key';\nconst SERVER_URL   = 'https://your-app.example.com'; // publicly reachable\nconst WEBHOOK_PATH = '/webhook/claudegate';\n\nconst app = express();\napp.use(express.json());\n\n// 1. Webhook receiver \u2014 ClaudeGate POSTs here when the job finishes.\n//    Security note: ClaudeGate does not sign requests. Restrict access at\n//    the network level (firewall / reverse-proxy allow-list) or add a\n//    shared-secret query param and verify it here before processing.\napp.post(WEBHOOK_PATH, (req, res) => {\n  const { job_id, status, result, error } = req.body;\n  console.log(`[webhook] job ${job_id} \u2192 ${status}`);\n  if (status === 'completed') {\n    console.log('Result:', result);\n    // TODO: save to database, emit to a WebSocket, send an email, \u2026\n  } else if (status === 'failed') {\n    console.error('Job failed:', error);\n  }\n  res.sendStatus(200); // always ACK quickly\n});\n\n// 2. Submit a job pointing back to this server\nasync function submitJob(prompt) {\n  const res = await fetch(`${BASE_URL}/api/v1/jobs`, {\n    method: 'POST',\n    headers: {\n      'X-API-Key': API_KEY,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      prompt,\n      model: 'sonnet',\n      callback_url: SERVER_URL + WEBHOOK_PATH\n    })\n  });\n  if (!res.ok) throw new Error('Failed: ' + res.status);\n  const { job_id } = await res.json();\n  console.log('Job queued:', job_id);\n}\n\napp.listen(3000, async () => {\n  console.log('Listening on :3000');\n  try {\n    await submitJob('Write a haiku about distributed systems.');\n  } catch (err) {\n    console.error('Failed to submit job:', err.message);\n  }\n});"
  },
  {
    label: 'Polling', lang: 'PHP / Guzzle', lang_class: 'php',
    code: "<?php\n// composer require guzzlehttp/guzzle\n// Submit a job and poll until it finishes.\n\nrequire __DIR__ . '/vendor/autoload.php';\n\nuse GuzzleHttp\\Client;\nuse GuzzleHttp\\Exception\\ClientException;\n\n$BASE_URL = 'https://example.com';\n$API_KEY  = 'your-api-key';\n\n$client = new Client([\n    'base_uri' => $BASE_URL,\n    'headers'  => ['X-API-Key' => $API_KEY],\n    'timeout'  => 30.0,\n]);\n\n// 1. Create a job\n$response = $client->post('/api/v1/jobs', [\n    'json' => [\n        'prompt' => 'Explain what a mutex is in one sentence.',\n        'model'  => 'haiku',\n    ],\n]);\n$job = json_decode($response->getBody(), true);\n$jobId = $job['job_id'];\necho \"Job queued: {$jobId}\\n\";\n\n// 2. Poll until terminal\n$terminal = ['completed', 'failed', 'cancelled'];\ndo {\n    sleep(1);\n    $response = $client->get(\"/api/v1/jobs/{$jobId}\");\n    $job = json_decode($response->getBody(), true);\n} while (!in_array($job['status'], $terminal, true));\n\nif ($job['status'] === 'completed') {\n    echo $job['result'] . \"\\n\";\n} else {\n    echo \"Job {$job['status']}: \" . ($job['error'] ?? 'unknown error') . \"\\n\";\n    exit(1);\n}\n\n// -- Cancel example --\n// try {\n//     $client->post(\"/api/v1/jobs/{$jobId}/cancel\");\n//     echo \"Job cancelled\\n\";\n// } catch (ClientException $e) {\n//     // 409 = already terminal\n//     echo $e->getResponse()->getBody() . \"\\n\";\n// }"
  }
];

function buildExamples() {
  var container = document.getElementById('integrationExamples');
  examples.forEach(function(ex, i) {
    var div = document.createElement('div');
    div.className = 'collapse-item';
    div.innerHTML =
      '<div class="collapse-head">' +
        '<span class="method-badge method-lang">' + ex.lang + '</span>' +
        '<span class="collapse-path non-mono">' + ex.label + '</span>' +
        '<span class="collapse-chevron">&#9654;</span>' +
      '</div>' +
      '<div class="collapse-body">' +
        '<div class="code-block"><button class="btn-copy">Copy</button><pre><code class="language-' + ex.lang_class + '">' + escapeHTML(ex.code) + '</code></pre></div>' +
      '</div>';

    div.querySelector('.collapse-head').addEventListener('click', function() {
      var body = div.querySelector('.collapse-body');
      var chev = div.querySelector('.collapse-chevron');
      var open = body.classList.toggle('open');
      chev.style.transform = open ? 'rotate(90deg)' : '';
    });

    div.querySelector('.btn-copy').addEventListener('click', function(e) {
      e.stopPropagation();
      navigator.clipboard.writeText(ex.code).then(function() {
        e.target.textContent = 'Copied!';
        setTimeout(function() { e.target.textContent = 'Copy'; }, 1500);
      }).catch(function() {});
    });

    container.appendChild(div);
  });
}

// ── Build all ──
buildGuide();
buildDocs();
buildExamples();
if (apiKey) loadHistory();
Prism.highlightAll();

// ── Splitter ──
(function() {
  var splitter = document.getElementById('splitter');
  var panelLeft = document.querySelector('.panel-left');
  var main = document.querySelector('.main');
  var dragging = false;
  var MIN_PCT = 20;

  function clamp(val, lo, hi) { return val < lo ? lo : val > hi ? hi : val; }

  function applyWidth(pct) {
    pct = clamp(pct, MIN_PCT, 100 - MIN_PCT);
    panelLeft.style.width = pct + '%';
    localStorage.setItem('cg_split_pos', pct);
  }

  var saved = parseFloat(localStorage.getItem('cg_split_pos'));
  if (saved && saved >= MIN_PCT && saved <= 100 - MIN_PCT) panelLeft.style.width = saved + '%';

  function startDrag() {
    dragging = true;
    splitter.classList.add('active');
    document.body.style.userSelect = 'none';
    document.body.style.cursor = 'col-resize';
  }

  function onMove(clientX) {
    if (!dragging) return;
    var rect = main.getBoundingClientRect();
    applyWidth(((clientX - rect.left) / rect.width) * 100);
  }

  function stopDrag() {
    if (!dragging) return;
    dragging = false;
    splitter.classList.remove('active');
    document.body.style.userSelect = '';
    document.body.style.cursor = '';
  }

  splitter.addEventListener('mousedown', function(e) { e.preventDefault(); startDrag(); });
  document.addEventListener('mousemove', function(e) { onMove(e.clientX); });
  document.addEventListener('mouseup', stopDrag);
  splitter.addEventListener('touchstart', function(e) { e.preventDefault(); startDrag(); }, { passive: false });
  document.addEventListener('touchmove', function(e) { if (dragging) { e.preventDefault(); onMove(e.touches[0].clientX); } }, { passive: false });
  document.addEventListener('touchend', stopDrag);
}());

})();
</script>
</body>
</html>
